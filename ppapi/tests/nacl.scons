# Copyright (c) 2010 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

Import('env')

ppapi_tests_target = 'ppapi_tests_%s.nexe' % env.get('TARGET_FULLARCH')

ppapi_tests_sources = [
        # Common test files
        'test_case.cc',
        'test_utils.cc',
        'testing_instance.cc',
        
        # Compile-time tests
        'test_c_includes.c',
        'test_cpp_includes.cc',
        'test_struct_sizes.c',

        # Test cases (PLEASE KEEP THIS SECTION IN ALPHABETICAL ORDER)
        # Add/uncomment PPAPI interfaces below when they get proxied.
        #'test_buffer.cc',
        #'test_char_set.cc',
        #'test_directory_reader.cc',
        #'test_file_io.cc',
        #'test_file_ref.cc',
        #'test_file_system.cc',
        'test_graphics_2d.cc',
        'test_image_data.cc',
        'test_paint_aggregator.cc',
        'test_post_message.cc',
        'test_scrollbar.cc',
        #'test_transport.cc',
        #'test_uma.cc',
        # Activating the URL loader test requires a test httpd that
        # understands HTTP POST, which our current httpd.py doesn't.
        # It also requires deactivating the tests that use FileIOTrusted
        # when running in NaCl.
        #'test_url_loader.cc',
        #'test_url_util.cc',
        #'test_video_decoder.cc',

        # Deprecated test cases.
        'test_instance_deprecated.cc',
        # Var_deprecated fails in TestPassReference, and we probably won't
        # fix it.
        #'test_var_deprecated.cc'
        ]

ppapi_tests_nexe = env.ComponentProgram(ppapi_tests_target,
                                        ppapi_tests_sources,
                                        EXTRA_LIBS=['${PPAPI_LIBS}',
                                                    'ppapi_cpp'
                                                    ])

# Note that the html is required to run this program.
# To run, load page with mode=nacl search string:
# http://localhost:5103/scons-out/nacl-x86-32/staging/test_case.html?mode=nacl
# http://localhost:5103/scons-out/nacl-x86-64/staging/test_case.html?mode=nacl

env.Publish(ppapi_tests_target, 'run',
            ['test_url_loader_data/*'], subdir='test_url_loader_data')

env.Publish(ppapi_tests_target, 'run',
            [ppapi_tests_nexe,
             'test_case.html',
             'test_case.nmf',
             'test_image_data',
             'test_page.css'])
